dist: focal
os: linux

jobs:
  allow_failures:
    env:
      - ALLOW_FAIL=true
  include:
    - stage: Run tests
      env:
        - ALLOW_FAIL=true
      script:
        - echo Done
        - echo $TRAVIS_TEST_RESULT > examine.txt
      workspaces:
        create:
          name: qa_test
          paths:
            - examine.txt
    - workspaces:
        use: qa_test
      env:
        - ALLOW_FAIL=true
      script:
        - false
        - echo $TRAVIS_TEST_RESULT >> examine.txt
    - script:
        - echo done
    - stage: Run Failure Script
      workspaces:
        use: qa_test
      script:
        - export status=$( cat examine.txt )
        - echo $status
        - if [[ "$status" =~ ^(?=.*1)[01]+$ ]]; then
            echo "RUN FAILURE SCRIPT";
          fi
