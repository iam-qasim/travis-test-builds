jobs:
  include:
    - os: linux
      dist: focal
      language: shell
      jdk:
        - openjdk11
      services:
        - postgresql
        - docker
        - redis
      addons:
        postgresql: "13"
        apt:
          packages:
            - postgresql-13
      env:
        global:
          - PGUSER=postgres
          - PGPORT=5432
          - PGHOST=localhost
      before_install:
        - sudo sed -i -e '/local.*peer/s/postgres/all/' -e 's/peer\|md5/trust/g' /etc/postgresql/*/main/pg_hba.conf
        - sudo service postgresql restart
        - sleep 1
        - postgres --version
      script: true
      
    - os: linux
      dist: xenial
      language: scala
      jdk:
        - openjdk11
      services:
        - postgresql
        - docker
        - redis
      addons:
        postgresql: "13"
        apt:
          packages:
            - postgresql-13
            - libssl-dev
            - python3-setuptools
            - python3-pip
      env:
        global:
          - PGUSER=postgres
          - PGPORT=5432
          - PGHOST=localhost
      before_install:
        #- sudo sed -i -e '/local.*peer/s/postgres/all/' -e 's/peer\|md5/trust/g' /etc/postgresql/*/main/pg_hba.conf
        #- sudo systemctl restart postgresql
        #- sleep 2
        - postgres --version
      script:
        - psql -c 'create database travis_ci_test;' -U postgres
        - echo done
