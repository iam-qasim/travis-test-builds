os: linux
dist: focal
rvm: "2.6.6"
services:
  - postgresql
addons:
   apt:
      packages:
         - postgresql-12
         - postgresql-client-12
      update: true
before_install:
    - sudo mount -o remount,size=50% /var/ramfs
    - sudo apt install -y postgresql-common
    - sudo sh /usr/share/postgresql-common/pgdg/apt.postgresql.org.sh -y
    - sudo apt-get install postgresql-12-postgis-2.5
    - sudo apt-get install postgresql-12-postgis-2.5-scripts
before_script:
    - 'sudo bash -c "sed -i ''s/#max_locks_per_transaction = 64/max_locks_per_transaction = 1024/g'' /etc/postgresql/12/main/postgresql.conf"'
    - 'sudo bash -c "sed -i ''s/#max_connections = 255/max_connections = 1000/g'' /etc/postgresql/12/main/postgresql.conf"'
    - 'sudo bash -c "cat /etc/postgresql/12/main/postgresql.conf"'
    - "sudo systemctl restart postgresql@12-main"
    - sleep 15
script: true
